import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import autoprefixer from 'autoprefixer';
import path from 'path';
import fs from 'fs';
import handlebars from 'handlebars';
import { nodePolyfills } from 'vite-plugin-node-polyfills';

const pages = {"dashboard":{"outputDir":"./dashboard","lang":"en","title":"Car Rental Dashboard","cacheVersion":12,"meta":[{"name":"title","content":"Car Rental Dashboard"},{"name":"description","content":"Dashboard for managing vehicles, bookings, customers, and revenue with charts and filters."},{"name":"keywords","content":"car rental, dashboard, vehicles, bookings, customers, revenue, charts, filters"},{"itemprop":"name","content":"Car Rental Dashboard"},{"itemprop":"description","content":"Dashboard for managing vehicles, bookings, customers, and revenue with charts and filters."},{"name":"twitter:card","content":"summary"},{"name":"twitter:title","content":"Car Rental SaaS Dashboard"},{"name":"twitter:description","content":"Manage your car rental business with dynamic data, charts, and filters."},{"property":"og:title","content":"Car Rental SaaS Dashboard"},{"property":"og:description","content":"Manage your car rental business with dynamic data, charts, and filters."},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/dashboard/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/dashboard/"}]},"vehicles":{"outputDir":"./vehicles","lang":"en","title":"Vehicles Management","cacheVersion":12,"meta":[{"name":"title","content":"Vehicles Management"},{"name":"description","content":"Manage and view the list of vehicles available for rent."},{"name":"keywords","content":"vehicles, car rental, management"},{"itemprop":"name","content":"Vehicles Management"},{"itemprop":"description","content":"Manage and view the list of vehicles available for rent."},{"name":"twitter:card","content":"summary"},{"name":"twitter:title","content":"Vehicles Management"},{"name":"twitter:description","content":"Manage your car rental vehicles with ease."},{"property":"og:title","content":"Vehicles Management"},{"property":"og:description","content":"Manage your car rental vehicles with ease."},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/vehicles/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/vehicles/"}]},"customers":{"outputDir":"./customers","lang":"en","title":"Customers Management","cacheVersion":12,"meta":[{"name":"title","content":"Customers Management"},{"name":"description","content":"Manage customer profiles and data for the car rental service."},{"name":"keywords","content":"customers, car rental, management"},{"itemprop":"name","content":"Customers Management"},{"itemprop":"description","content":"Manage customer profiles and data for the car rental service."},{"name":"twitter:card","content":"summary"},{"name":"twitter:title","content":"Customers Management"},{"name":"twitter:description","content":"Manage your car rental customers."},{"property":"og:title","content":"Customers Management"},{"property":"og:description","content":"Manage your car rental customers."},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/customers/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/customers/"}]},"bookings":{"outputDir":"./bookings","lang":"en","title":"Bookings Management","cacheVersion":12,"meta":[{"name":"title","content":"Bookings Management"},{"name":"description","content":"View and manage all bookings with filters and status updates."},{"name":"keywords","content":"bookings, car rental, management"},{"itemprop":"name","content":"Bookings Management"},{"itemprop":"description","content":"View and manage all bookings with filters and status updates."},{"name":"twitter:card","content":"summary"},{"name":"twitter:title","content":"Bookings Management"},{"name":"twitter:description","content":"Manage car rental bookings efficiently."},{"property":"og:title","content":"Bookings Management"},{"property":"og:description","content":"Manage car rental bookings efficiently."},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/bookings/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/bookings/"}]},"campaign-builder":{"outputDir":"./campaign-builder","lang":"en","title":"Campaign Builder","cacheVersion":12,"meta":[{"name":"title","content":"Campaign Builder"},{"name":"description","content":"Create marketing campaigns powered by OpenAI for the car rental SaaS."},{"name":"keywords","content":"campaign builder, marketing, OpenAI, car rental"},{"itemprop":"name","content":"Campaign Builder"},{"itemprop":"description","content":"Create marketing campaigns powered by OpenAI for the car rental SaaS."},{"name":"twitter:card","content":"summary"},{"name":"twitter:title","content":"Campaign Builder"},{"name":"twitter:description","content":"Build marketing campaigns using AI for your car rental business."},{"property":"og:title","content":"Campaign Builder"},{"property":"og:description","content":"Build marketing campaigns using AI for your car rental business."},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/campaign-builder/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/campaign-builder/"}]},"index":{"outputDir":"./","lang":"en","title":"","cacheVersion":12,"meta":[{"name":"twitter:card","content":"summary"},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/"}]},"ai-marketing":{"outputDir":"./ai-marketing","lang":"en","title":"","cacheVersion":12,"meta":[{"name":"twitter:card","content":"summary"},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/ai-marketing/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/ai-marketing/"}]},"live-tracking":{"outputDir":"./live-tracking","lang":"en","title":"","cacheVersion":12,"meta":[{"name":"twitter:card","content":"summary"},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/live-tracking/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/live-tracking/"}]},"settings":{"outputDir":"./settings","lang":"en","title":"","cacheVersion":12,"meta":[{"name":"twitter:card","content":"summary"},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/settings/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/settings/"}]},"revenue":{"outputDir":"./revenue","lang":"en","title":"Revenue Analytics","cacheVersion":12,"meta":[{"name":"title","content":"Revenue Analytics"},{"name":"description","content":"View revenue data with charts and filters for the car rental business."},{"name":"keywords","content":"revenue, analytics, car rental"},{"itemprop":"name","content":"Revenue Analytics"},{"itemprop":"description","content":"View revenue data with charts and filters for the car rental business."},{"name":"twitter:card","content":"summary"},{"name":"twitter:title","content":"Revenue Analytics"},{"name":"twitter:description","content":"Analyze your car rental revenue with charts and filters."},{"property":"og:title","content":"Revenue Analytics"},{"property":"og:description","content":"Analyze your car rental revenue with charts and filters."},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/revenue/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/revenue/"}]},"loginpage":{"outputDir":"./loginpage","lang":"en","title":"","cacheVersion":12,"meta":[{"name":"twitter:card","content":"summary"},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/loginpage/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/loginpage/"}]},"livetracking":{"outputDir":"./livetracking","lang":"en","title":"","cacheVersion":12,"meta":[{"name":"twitter:card","content":"summary"},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/livetracking/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/livetracking/"}]},"vecletrck":{"outputDir":"./vecletrck","lang":"en","title":"Car Rental Dashboard","cacheVersion":12,"meta":[{"name":"title","content":"Car Rental Dashboard"},{"name":"description","content":"Dashboard for managing vehicles, bookings, customers, and revenue with charts and filters."},{"name":"keywords","content":"car rental, dashboard, vehicles, bookings, customers, revenue, charts, filters"},{"itemprop":"name","content":"Car Rental Dashboard"},{"itemprop":"description","content":"Dashboard for managing vehicles, bookings, customers, and revenue with charts and filters."},{"name":"twitter:card","content":"summary"},{"name":"twitter:title","content":"Car Rental SaaS Dashboard"},{"name":"twitter:description","content":"Manage your car rental business with dynamic data, charts, and filters."},{"property":"og:title","content":"Car Rental SaaS Dashboard"},{"property":"og:description","content":"Manage your car rental business with dynamic data, charts, and filters."},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/vecletrck/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/vecletrck/"}]},"forlivetracking":{"outputDir":"./forlivetracking","lang":"en","title":"","cacheVersion":12,"meta":[{"name":"twitter:card","content":"summary"},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/forlivetracking/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/forlivetracking/"}]},"message-new":{"outputDir":"./message-new","lang":"en","title":"","cacheVersion":12,"meta":[{"name":"twitter:card","content":"summary"},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/message-new/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/message-new/"}]},"message":{"outputDir":"./message","lang":"en","title":"","cacheVersion":12,"meta":[{"name":"twitter:card","content":"summary"},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/message/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/message/"}]},"vehiclelivetracking":{"outputDir":"./vehiclelivetracking","lang":"en","title":"","cacheVersion":12,"meta":[{"name":"twitter:card","content":"summary"},{"property":"og:type","content":"website"},{"name":"robots","content":"index, follow"}],"scripts":{"head":"\n","body":"\n"},"baseTag":{"href":"/","target":"_self"},"alternateLinks":[{"rel":"alternate","hreflang":"x-default","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/vehiclelivetracking/"},{"rel":"alternate","hreflang":"en","href":"https://804c5067-58c6-49d7-bd6d-d53fba238b2e.weweb-preview.io/vehiclelivetracking/"}]}};

// Read the main HTML template
const template = fs.readFileSync(path.resolve(__dirname, 'template.html'), 'utf-8');
const compiledTemplate = handlebars.compile(template);

// Generate an HTML file for each page with its metadata
Object.values(pages).forEach(pageConfig => {
    // Compile the template with page metadata
    const html = compiledTemplate({
        title: pageConfig.title,
        lang: pageConfig.lang,
        meta: pageConfig.meta,
        scripts: {
            head: pageConfig.scripts.head,
            body: pageConfig.scripts.body,
        },
        alternateLinks: pageConfig.alternateLinks,
        cacheVersion: pageConfig.cacheVersion,
        baseTag: pageConfig.baseTag,
    });

    // Save output html for each page
    if (!fs.existsSync(pageConfig.outputDir)) {
        fs.mkdirSync(pageConfig.outputDir, { recursive: true });
    }
    fs.writeFileSync(`${pageConfig.outputDir}/index.html`, html);
});

const rollupOptionsInput = {};
for (const pageName in pages) {
    rollupOptionsInput[pageName] = path.resolve(__dirname, pages[pageName].outputDir, 'index.html');
}

export default defineConfig(() => {
    return {
        plugins: [nodePolyfills({ include: ['events', 'stream', 'string_decoder'] }), vue()],
        base: "/",
        resolve: {
            alias: {
                '@': path.resolve(__dirname, './src'),
            },
        },
        css: {
            preprocessorOptions: {
                scss: {
                    api: 'modern-compiler',
                },
            },
            postcss: {
                plugins: [autoprefixer],
            },
        },
        build: {
            chunkSizeWarningLimit: 10000,
            rollupOptions: {
                input: rollupOptionsInput,
                onwarn: (entry, next) => {
                    if (entry.loc?.file && /js$/.test(entry.loc.file) && /Use of eval in/.test(entry.message)) return;
                    return next(entry);
                },
                maxParallelFileOps: 900,
            },
        },
        logLevel: 'warn',
    };
});
